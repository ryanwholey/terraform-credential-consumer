name: Test github-script Action
on:
  pull_request:
    paths:
      - .github/workflows/test-merge-json-array.yml
  push:
    branches:
      - main
    paths:
      - .github/workflows/test-merge-json-array.yml
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - id: simulate-fetch
        run: echo '::set-output name=result::["foo", "bar"]'
      - id: simulate-input
        run: |-
          str='["baz","woz"]'
          echo "::add-mask::$str"
          echo "::set-output name=result::$str"
      - uses: actions/github-script@v5
        id: result
        with:
          script: |-
            const first = JSON.parse("${{ steps.simulate-input.outputs.result }}") || "[]")
            const second = JSON.parse("${{ steps.simulate-fetch.outputs.result }}") || "[]")
            
            const merged = [...first, ...second]
            
            return JSON.stringify(merged)
          result-encoding: string
      - run: echo ${{ steps.result.outputs.result }}
